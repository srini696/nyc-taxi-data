{
    "stateMachineArn": "arn:aws:states:us-east-1:473157801752:stateMachine:mdm-pipeline",
    "name": "mdm-pipeline",
    "status": "ACTIVE",
    "definition": "{\"Comment\":\"NYC Taxi MDM Pipeline - Integrated with Glue ETL Jobs\",\"StartAt\":\"InitializePipeline\",\"States\":{\"InitializePipeline\":{\"Type\":\"Pass\",\"Comment\":\"Initialize pipeline with timestamp and execution ID\",\"Parameters\":{\"pipelineRunId.$\":\"States.Format('mdm-run-{}-{}', $$.Execution.StartTime, $$.Execution.Name)\",\"triggeredBy\":\"glue-workflow\",\"executionStartTime.$\":\"$$.Execution.StartTime\",\"sourceSystem\":\"nyc_taxi_curated\",\"processedCount\":0},\"ResultPath\":\"$\",\"Next\":\"RunRawToValidatedGlue\"},\"RunRawToValidatedGlue\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::glue:startJobRun.sync\",\"Parameters\":{\"JobName\":\"yellow_raw_to_validated\"},\"ResultPath\":\"$.rawToValidatedResult\",\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":30,\"MaxAttempts\":2,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.glueError\",\"Next\":\"LogGlueFailure\"}],\"Next\":\"RunValidatedToCuratedGlue\"},\"RunValidatedToCuratedGlue\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::glue:startJobRun.sync\",\"Parameters\":{\"JobName\":\"yellow_validated_to_curated\"},\"ResultPath\":\"$.validatedToCuratedResult\",\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":30,\"MaxAttempts\":2,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.glueError\",\"Next\":\"LogGlueFailure\"}],\"Next\":\"FetchCuratedData\"},\"FetchCuratedData\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-fetch-curated-trips\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\",\"batchSize\":1000,\"processingMode\":\"incremental\"}},\"ResultSelector\":{\"pipelineRunId.$\":\"$.Payload.pipelineRunId\",\"tripIds.$\":\"$.Payload.tripIds\",\"recordCount.$\":\"$.Payload.recordCount\",\"hasMore.$\":\"$.Payload.hasMore\"},\"ResultPath\":\"$.curatedDataBatch\",\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":300,\"MaxAttempts\":3,\"BackoffRate\":2}],\"Next\":\"CheckDataAvailable\"},\"CheckDataAvailable\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.curatedDataBatch.recordCount\",\"NumericGreaterThan\":0,\"Next\":\"ProcessTripBatch\"}],\"Default\":\"NoDataToProcess\"},\"ProcessTripBatch\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-extract-references\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\",\"tripIds.$\":\"$.curatedDataBatch.tripIds\",\"sourceSystem.$\":\"$.sourceSystem\"}},\"ResultSelector\":{\"tripsProcessed.$\":\"$.Payload.tripsProcessed\",\"tripsNeedingReview.$\":\"$.Payload.tripsNeedingReview\",\"totalProcessed.$\":\"$.Payload.totalProcessed\"},\"ResultPath\":\"$.batchResult\",\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":3,\"BackoffRate\":2}],\"Next\":\"UpdateProcessedCount\"},\"UpdateProcessedCount\":{\"Type\":\"Pass\",\"Parameters\":{\"pipelineRunId.$\":\"$.pipelineRunId\",\"sourceSystem.$\":\"$.sourceSystem\",\"processedCount.$\":\"States.MathAdd($.processedCount, $.batchResult.totalProcessed)\",\"rawToValidatedResult.$\":\"$.rawToValidatedResult\",\"validatedToCuratedResult.$\":\"$.validatedToCuratedResult\",\"executionStartTime.$\":\"$.executionStartTime\",\"hasMore.$\":\"$.curatedDataBatch.hasMore\"},\"Next\":\"CheckForMoreData\"},\"CheckForMoreData\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.hasMore\",\"BooleanEquals\":true,\"Next\":\"FetchCuratedData\"}],\"Default\":\"CheckForStewardReviews\"},\"CheckForStewardReviews\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-aggregate-review-items\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\"}},\"ResultSelector\":{\"pendingCount.$\":\"$.Payload.pendingCount\",\"summary.$\":\"$.Payload.summary\"},\"ResultPath\":\"$.reviewSummary\",\"Next\":\"HasPendingReviews\"},\"HasPendingReviews\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.reviewSummary.pendingCount\",\"NumericGreaterThan\":0,\"Next\":\"PrepareSNSMessage\"}],\"Default\":\"CreateGoldenRecordTable\"},\"PrepareSNSMessage\":{\"Type\":\"Pass\",\"Parameters\":{\"pipelineRunId.$\":\"$.pipelineRunId\",\"summary.$\":\"$.reviewSummary.summary\",\"message\":\"MDM records require steward review and approval\",\"totalPending.$\":\"$.reviewSummary.pendingCount\"},\"ResultPath\":\"$.snsMessagePayload\",\"Next\":\"NotifyStewardReview\"},\"NotifyStewardReview\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::sns:publish\",\"Parameters\":{\"TopicArn\":\"arn:aws:sns:us-east-1:473157801752:mdm-steward-alerts\",\"Message.$\":\"States.JsonToString($.snsMessagePayload)\",\"Subject\":\"MDM Review Required - Pending Approval\"},\"ResultPath\":\"$.snsResult\",\"Next\":\"WaitForStewardApproval\"},\"WaitForStewardApproval\":{\"Type\":\"Wait\",\"Seconds\":300,\"Next\":\"CheckApprovalStatus\"},\"CheckApprovalStatus\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-check-approval\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\"}},\"ResultSelector\":{\"allApproved.$\":\"$.Payload.allApproved\",\"anyRejected.$\":\"$.Payload.anyRejected\",\"stillPending.$\":\"$.Payload.stillPending\"},\"ResultPath\":\"$.approvalStatus\",\"Next\":\"ApprovalDecision\"},\"ApprovalDecision\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.approvalStatus.allApproved\",\"BooleanEquals\":true,\"Next\":\"EnrichPendingTrips\"},{\"Variable\":\"$.approvalStatus.anyRejected\",\"BooleanEquals\":true,\"Next\":\"HandleRejectedRecords\"},{\"Variable\":\"$.approvalStatus.stillPending\",\"BooleanEquals\":true,\"Next\":\"WaitForStewardApproval\"}],\"Default\":\"HandleRejectedRecords\"},\"EnrichPendingTrips\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-batch-enrich-trips\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\"}},\"ResultPath\":\"$.enrichedPendingTrips\",\"Next\":\"CreateGoldenRecordTable\"},\"HandleRejectedRecords\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-log-rejected-records\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\"}},\"ResultPath\":\"$.rejectionLog\",\"Next\":\"CreateGoldenRecordTable\"},\"CreateGoldenRecordTable\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-create-golden-table\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\"}},\"ResultSelector\":{\"recordsCreated.$\":\"$.Payload.recordsCreated\"},\"ResultPath\":\"$.goldenTableResult\",\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":3,\"BackoffRate\":2}],\"Next\":\"UpdateAuditTables\"},\"UpdateAuditTables\":{\"Type\":\"Parallel\",\"Branches\":[{\"StartAt\":\"UpdateVendorHistory\",\"States\":{\"UpdateVendorHistory\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-update-audit-history\",\"Payload\":{\"entityType\":\"vendor\",\"pipelineRunId.$\":\"$$.Execution.Name\"}},\"End\":true}}},{\"StartAt\":\"UpdateZoneHistory\",\"States\":{\"UpdateZoneHistory\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-update-audit-history\",\"Payload\":{\"entityType\":\"zone\",\"pipelineRunId.$\":\"$$.Execution.Name\"}},\"End\":true}}},{\"StartAt\":\"UpdateRatecodeHistory\",\"States\":{\"UpdateRatecodeHistory\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-update-audit-history\",\"Payload\":{\"entityType\":\"ratecode\",\"pipelineRunId.$\":\"$$.Execution.Name\"}},\"End\":true}}}],\"ResultPath\":\"$.auditUpdateResults\",\"Next\":\"LogPipelineExecution\"},\"LogPipelineExecution\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-log-pipeline-execution\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\",\"executionStatus\":\"SUCCESS\",\"glueJobs\":{\"rawToValidated.$\":\"$.rawToValidatedResult\",\"validatedToCurated.$\":\"$.validatedToCuratedResult\"},\"recordsProcessed.$\":\"$.processedCount\",\"goldenRecordsCreated.$\":\"$.goldenTableResult.recordsCreated\",\"pendingReviews.$\":\"$.reviewSummary.pendingCount\",\"executionTime\":{\"start.$\":\"$.executionStartTime\",\"end.$\":\"$$.State.EnteredTime\"}}},\"ResultPath\":\"$.executionLog\",\"Next\":\"PipelineSuccess\"},\"NoDataToProcess\":{\"Type\":\"Pass\",\"Result\":{\"status\":\"NO_DATA\",\"message\":\"No new curated data available for processing\"},\"Next\":\"LogPipelineExecution\"},\"LogGlueFailure\":{\"Type\":\"Task\",\"Resource\":\"arn:aws:states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"mdm-log-pipeline-execution\",\"Payload\":{\"pipelineRunId.$\":\"$.pipelineRunId\",\"executionStatus\":\"GLUE_FAILURE\",\"error.$\":\"$.glueError\"}},\"Next\":\"PipelineFailed\"},\"PipelineSuccess\":{\"Type\":\"Succeed\"},\"PipelineFailed\":{\"Type\":\"Fail\",\"Error\":\"PipelineExecutionError\",\"Cause\":\"Pipeline execution failed\"}}}",
    "roleArn": "arn:aws:iam::473157801752:role/service-role/StepFunctions-mdm-pipeline-role-ggacx4q5j",
    "type": "STANDARD",
    "creationDate": "2026-01-15T00:52:18.158000+00:00",
    "loggingConfiguration": {
        "level": "OFF",
        "includeExecutionData": false
    },
    "tracingConfiguration": {
        "enabled": false
    },
    "revisionId": "5b6fb5e0-dd4c-401d-bc01-d48619812131",
    "encryptionConfiguration": {
        "type": "AWS_OWNED_KEY"
    }
}
